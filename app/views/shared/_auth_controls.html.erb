<% devise_mapping = Devise.mappings[:user] %>
<div id="auth_controls">
  <% if !signed_in?(:user) && controller_name != 'sessions' %>
    <%= form_for :user, :as => :user,  :url => session_path(:user) do |form| %>
      <div class='row'>
        <%= form.label :email, 'Email', :class => 'inlined' %>
        <%= form.text_field :email, :size => 20, :class => 'input-text' %>
      </div>
      <div class='row'>
        <%= form.label :password, 'Password', :class => 'inlined' %>
        <%= form.password_field :password, :size => 20, :class => 'input-text' %>
      </div>
      <br/>

      <% if devise_mapping.rememberable? %>
        <%= form.check_box :remember_me %>
        <%= form.label :remember_me %>
      <% end %>

      <%= form.submit "Sign in", :disable_with => "Please wait..." %>
    <% end %>
    <%- if devise_mapping.registerable? && controller_name != 'registrations' %>
      <%= link_to 'Sign up', new_registration_path(:user) %>
      &nbsp;|&nbsp;
    <% end -%>
    <%- if devise_mapping.recoverable? && controller_name != 'passwords' %>
      <%= link_to 'Forgot your password?', new_password_path(:user) %>
    <% end -%>
  <% elsif logged_in? %>
    <%= current_user.email %> <%= link_to '[Sign out]',
    destroy_session_path(:user) %>
    <% if session[:impersonated_by] %>
      <%= link_to '[Deimpersonate]', deimpersonate_admin_users_path, :method => :post %>
    <% end %>
  <% end %>
</div>
